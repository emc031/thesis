\chapter{Lattice Calculations}
\label{chap:latticecalculations}

The last chapter focused on how to discretize QCD on a lattice. This chapter is focused on the practical side of lattice QCD - given a lattice action, how does one perform the functional integral to determine expectation values of operators.

\section{Evaluating Lattice Correlation Functions}

All physics of a quantum field theory can be extracted from correlation functions. So a typical lattice calculation involves computing a correlation function (or just {\it{correlator}}) on the lattice, then extracting physical quantities from it. A typical correlator that is computed on the lattice is a 2-point meson correlator, i.e. when $\mathcal{O} = \Phi(x)\Phi^{\dagger}(y)$ and $\Phi$ is a meson creation operator. This is a good working example for showing the steps in a lattice calculation, the generalization to $N-$point correlators is reasonably natural.

A creation operator for a meson in this context can be any operator containing the same quantum numbers as the meson one studying. For example, the neutral $B$ meson is a pseudoscalar charged with a $d$ and $\bar{b}$ quark, so a suitable operator is $\Phi(x) = \bar{b}(x)\gamma_5 d(x)$. The corresponding functional can then be written as
\begin{align}
  \nonumber
  C(x,y) = \langle \Phi(x)\Phi^{\dagger}(y)\rangle =& \int [d\psi d\bar{\psi} dU] \left(\, \bar{b}(x)\gamma_5 d(x) \bar{d}(y)\gamma_5 b(y) \text{ }\right) \\&\times \exp\left(-S_G[U]-\sum_{w,z,i} \bar{q}_i(w)M_{q_i}(w,z)[U]q_i(z)\right),
\end{align}
where we have broken the action up into a gauge part $S_G[U]$, and a fermion part. $M_{q_i}(x,y)[U]$ is the Dirac operator for flavour $i$, and can be seen as a matrix in lattice site, color and spin.

The integral over fermions can be performed analytically since the fermion fields are Grassman valued. In our example, the result is \cite{Peskin:1995ev};
\begin{align}
  \nonumber
  C(x,y) = \int [dU] &\text{Tr}\left( \, M^{-1}_b(y,x)[U] \, \gamma_5 \, M^{-1}_d(x,y)[U] \, \gamma_5 \, \right) \\ &\times e^{-S_G[U]} \prod_i\text{det}(M_{q_i}[U]).
  \label{eq:lattice_correlator}
\end{align}
The quantinties $M_{q_i}^{-1}(x,y)[U]$ are propagators of a quark of flavour $q$ on a fixed gauge background $U$. Here $U$ denotes a configuration of angles comprising an $SU(3)$ matrix for each element of the set of all links on the lattice $\{ U_{\mu}(x) | \,\forall \,\mu,\,x \}$. The trace is over color and spin. The integration over gauge fields is generally carried out by an importance sampling method. A finite \textit{ensemble} of gauge configurations $\{U_n\}$ is generated by a Monte Carlo Markov Chain (MCMC), where the probability of a gauge configuration $U_n$ being added to the ensemble is proportional to
\begin{align}
  p(U_n) = e^{-S_G[U_n]}\prod_i\text{det}(M_{q_i}[U_n]).
  \label{eq:MCweight}
\end{align}

Once the ensemble is created, the path integral can be approximated by simply
\begin{align}
  C(x,y) \simeq {1\over N} \sum_n \text{ Tr}\left[\text{ } M^{-1}_b(y,x)[U_n] \gamma_5 M^{-1}_d(x,y)[U_n] \gamma_5 \text{ }\right]
  \label{eq:av_gauge}
\end{align}
where $N$ is the size of the ensemble. The calculation of the correlation function then is split into 3 steps:
\begin{enumerate}
\item
  Generate an ensemble of Gauge configurations $\{ U_i \}$ by MCMC (sec. \ref{sec:MCMC}).
\item
  Compute $M^{-1}_{q_i}(x,y)[U]$ by inverting the Dirac operator on each Gauge configuration (sec. \ref{sec:inversions}).
\item
  Construct trace as in \eqref{eq:av_gauge}, and average over the ensemble. This step is dealt with in the context of staggered quarks in \ref{sec:staggeredcorrelators}.
\end{enumerate}


\subsection{Generation of Gauge Ensembles}
\label{sec:MCMC}

The calculation requires a number of samples of gauge configurations $\{U_n\}$ sampled from the distribution $p(U)$ defined in \eqref{eq:MCweight}.

The physical interpretation of the determinant in \eqref{eq:MCweight} is that it accounts for virtual quark loops in the Dirac sea. In the early days of lattice calculations, this determinant was approximated to 1, since its presence caused an insurmountable computational cost, and it was expected that sea quarks had small effects on observables (this is known as the {\it{quenched approximation}}). These days, our computational ability has improved and sophisticated approaches to the determinant have been developed, so we can include it in our calculations.

We will roughly follow the history of gauge ensemble generation, by first ignoring the determinant, and then showing how it is eventually included in the process.

\subsubsection{Quenched MCMC}

Gauge ensembles are generated via an MCMC, inspired by statistical mechanics. The distribution exp$(-S_G[U])$ is suggestive of something like a Boltzmann distribution for a gas of particles, each with some state $U_i$, in thermal equilibrium. The ergodic hypothesis states that a single particle in this gas will jump between possible states over time such that, at any given time, its probability of being in state $U_i$ is given by exp$(-S_G[U_i])$. In MCMC, one starts with some random state $U_0$, then repeatedly updates the state according to some update 'hopping rate' $p(U_i\to U_j)$. This results in a list of states that appear sampled from the distribution exp$(-S_G[U])$.

The hopping rate must be designed to bring the chain into thermal equilibrium with the correct distribution. A sufficient condition for thermal equilibrium is so-called {\it{detailed balance}}, where the probability of jumps between any pair of states $i$ and $j$ is equal:
\begin{align}
  p(U_i) p(U_i\to U_j) = p(U_j) p(U_j\to U_i).
\end{align}
Hence $p(U_i\to U_j)$ must be designed according to the rule
\begin{align}
  {p(U_i\to U_j) \over p(U_j\to U_i)} = \exp(-(S_G[U_i]-S_G[U_j])).
  \label{eq:detailed_balance}
\end{align}
There are a number of possible choices of how to design $p(U_i\to U_j)$. One approach, known as {\bf{molecular dynamics}} \cite{PhysRevLett.49.613,PhysRevD.28.1506} is to model the chain as the trajectory $U(\tau)$ of a system with hamiltonian
\begin{align}
  H(\pi,U) = {\pi^2\over 2} + S_G[U],
\end{align}
where $\pi$ is a ficticous momentum conjugate to $U$. It can be demonstrated that such a trajectory obeys \eqref{eq:detailed_balance}. The trajectory is computed via Runge-Kutta methods. To deal with the possibility of fixed points, limit cycles etc. in the dynamics (which would prevent ergodicity), one can introduce a periodic {\bf{refreshing}} step, where $\pi$ assigned a new value from normally distributed noise \cite{PhysRevLett.55.2774,duane1986}.

Another problem that can occur in molecular dynamics is when errors in Runge-Kutta iterations accumulate over time. Diversion from the dynamics enforced by $H(\pi,U)$ can ruin the ergodicity of the trajectory. To fix this, one can add a {\bf{Metropolis}} step at regular intervals $\delta\tau$ throughout the evolution \cite{doi:10.1063/1.1699114}. In this step, one either accepts (continues onto the next stage of molecular dynamics) or rejects (refreshes $\pi$ and re-calculates the last stage of molecular dynamics), according to the criterion
\begin{itemize}
\item
  If $S_G[U(\tau+\delta\tau)] < S_G[U(\tau)]$, always accept
\item
  Otherwise, accept if $\exp\left(S_G[U(\tau+\delta\tau)] - S_G[U(\tau)]\right) > \lambda$, where $\lambda$ is randomly chosen from the interval $[0,1]$.
\end{itemize}
The metropolis step ensures \eqref{eq:detailed_balance} is satisfied even in the presence of Runge-Kutta errors.

The combination of molecular dynamics, refreshing steps and Metropolis steps is referred to as {\bf{Hybrid Monte Carlo}} \cite{DUANE1987216}, and is the basic structure of how the ensembles we use in this thesis were generated. We now address how the determinant det$M$ is included.

\subsubsection{Unquenched MCMC}

Simply evaluating det$M[U]$ directly, given a configuration $U$, is prohibitively expensive due to the non-local nature of the determinant (recall $M[U]$ is a matrix in spin, colour, and lattice site, in modern calculations this will have a dimension of order $10^8$.) A solution to this is to use the $\Phi$-algorithm \cite{PhysRevD.35.2531}.

First, we replace det$M$ with det$M^{\dagger}M$. If we were only including $u$ and $d$ quarks in the sea, this would be fine since we can approximate $u$ and $d$ to be two degenerate flavours, then $\prod_q \det M_q = \det M \det M = \det M^{\dagger} M$. In the case of an arbitrary set of flavours, this requires a correction that will be addressed later.
This involves introducing new scalar fields $\Phi(x)$ and $\Phi^{\dagger}(x)$ via
\begin{align}
  \det M^{\dagger} M = \int [d\Phi^{\dagger}d\Phi] \exp(-\Phi^{\dagger} (M^{\dagger}M)^{-1}\Phi).
\end{align}
then one can add $-\Phi^{\dagger} (M^{\dagger}M)^{-1}\Phi$ to $S_G$ in the Hybrid Monte Carlo algorithm. The extra functional integral over $\Phi,\Phi^{\dagger}$ is easly evaluated, by sampling a vector $\eta$ from a normal distribution exp$(-\eta^{\dagger}\eta)$, then transforming it to $\Phi = M^{\dagger} \eta$.

\subsubsection{The Dreaded Rooting Procedure}

We will now address how to correct for the fact that we have replaced det$M$ with det$M^{\dagger}M$ in the presence of arbitrary non-degenerate flavours. We have explicitly doubled the fermions to two degenerate flavours per physical flavour. In the case of staggered quarks, this is not a huge deal since we already have four degenerate tastes which we have to deal with anyway. As mentioned in Sec. \ref{sec:staggeredquarks}, in order to cut down the number of tastes in the sea, the solution is to take the fourth-root of det$M$. When using the $\Phi$-algorithm, this becomes the 8-th root of det$M^{\dagger}M$.
\begin{align}
  (\det M^{\dagger} M )^{1/8} &= (\prod_i \lambda_i^2)^{1/8} = (\prod_i \lambda_i)^{1/4} \\ \nonumber &\stackrel{?}{=} (\prod_i\lambda_i^{'\,4})^{1/4} = \prod_i \lambda'_i \quad (a\to 0).
\end{align}
where $\lambda_i$ are eigenvalues of $M$. On the second line, we have assumed that the matrix $M$ can be decomposed into four matrices for each of the four tastes, with eigenvalues $\lambda'_i$ which are degenerate in the continuum limit.

This assumption is not rigorously justified in field theory, so the fourth-root trick is a source of much controversy, and is the main objection to staggered quarks \cite{JANSEN20043,CREUTZ2007230,Creutz:2007rk}. There has so far emerged no evidence that this is harmful, since all observables ever computed from the staggered quark formalism have agreed with experiment, analytical approaches, and other lattice discretisations. The empiricists among us would say this is evidence for the validity of the fourth-root trick.

Introducing the $1/2$ or $1/8$th root to the determinant requires a modification of the $\Phi$ algorithm, we can no longer simply sample $\Phi$ using $\Phi=M^{\dagger}\eta$. The effective action is now $S_G + \Phi^{\dagger} (M^{\dagger}M)^{-1/8} \Phi$. The root is dealt with by replacing it with a partial fraction representation \cite{Clark:2006fx};
\begin{align}
  (M^{\dagger}M)^{-1/8} \simeq a_0 + \sum_{n=1}^N { a_n \over M^{\dagger}M + b_n }.
  \label{eq:rational}
\end{align}
This can only be evaluated by some variation of a conjugate gradient algorithm (specifically a so-called multishift solver \cite{Frommer:1995ik,Jegerlehner:1996pm}), conjugate gradient will be described in sec. \ref{sec:inversions}. This approach is called the {\bf{Rational Hybrid Monte Carlo}} (RHMC) algorithm.

\subsubsection{The $N_f=2+1+1$ MILC Ensembles}

In this work we use ensembles of gauge configurations generated by the MILC collaboration \cite{Bazavov:2012xda,Bazavov:2010ru}. The ingredients of these configurations are
\begin{itemize}
\item
  Gauge fields obeying the one-loop Symmanzik improved L\"uscher-Weitz action described in Sec. \ref{sec:symmanzik_gauge}.
\item
  Four flavours of quark in the sea, $u$,$d$,$s$ and $c$ (with $m_u=m_d\equiv m_l$), hence the notation $N_f=2+1+1$, obeying the HISQ action, described in sec. \ref{sec:HISQ}.
\item
  Ensemble generated using the RHMC Algorithm as described earlier in this section.
\end{itemize}
Table \ref{tab:ensembles} gives the details of the MILC ensembles that were used in this work. One may notice that for the majority of ensembles here, the light quarks are obscenely heavier than in reality. The necessity for this is explained in the next section.

\begin{table*}[t]
  \begin{center}
    \begin{tabular}{c c c c c c c c c c}
      \hline
      set & handle & $a/$fm  & $N_x^3\times N_t$ & $am_{l0}$ & $am_{s0}$ & $am_{c0}$  \\ [0.5ex]
      \hline
      0 & \bf{very coarse} & 0.1543(8) & $16^3\times48$ & 0.013 & 0.067 & 0.838 \\ [1ex]
      1 & \bf{coarse} & 0.1241(7) & $24^3\times64$ & 0.0102 & 0.0509 & 0.635 \\ [1ex]
      2 & \bf{fine} & 0.0884(6) & $32^3\times96$ & 0.0074 & 0.037 & 0.440 \\ [1ex]
      3 & \bf{fine-physical} & 0.0873(5) & $64^3\times96$ & 0.0012 & 0.0363 & 0.432 \\ [1ex]
      4 & \bf{superfine} & 0.05922(12) & $48^3\times144$ & 0.0048 & 0.024 & 0.286 \\ [1ex]
      5 & \bf{ultrafine} & 0.04406(23) &  $64^3\times192$ & 0.00316 & 0.0158 & 0.188  \\ [1ex]
      \hline
    \end{tabular}
  \end{center}
  \caption{Parameters for gluon ensembles \cite{Bazavov:2010ru,Bazavov:2012xda}. $a$ values for sets 0-3 were deduced in \cite{Dowdall:2013rya}, set 4 from \cite{Chakraborty:2014aca}. We thank C. McNeile for computing the $a$ value on set 5. These $a$ values are determined by measuring the Wilson flow parameter $w_0/a$ on the lattice, then using the known value for $w_0$ to isolate $a$. Columns 5-7 give the masses used in the action for light,strange and charm quarks in the sea. \label{tab:ensembles}}
\end{table*}


\subsection{Dirac Operator Inversion}
\label{sec:inversions}

Once the ensemble $\{U_i\}$ has been generated, to compute the 2-point correlator \eqref{eq:av_gauge} one must compute $M^{-1}[U_i]$ for each $U_i$. We have already seen how this can be done in the case of the flavour in question being governed by the NRQCD action, one can use the recursion relation \eqref{eq:nrqcd_recursion}. In the case of relativistic actions like HISQ, there is no equivalent recursion relation.

$M$ is large but sparse, it technically has $\order{\text{Vol}^2}$ elements, but for suitably local actions (like HISQ) it has only $\order{\text{Vol}}$ non-zero elements. This means it is well-suited to the {\bf{conjugate gradient}} (CG) algorithm \cite{Hestenes&Stiefel:1952} (and it's variants), which has become the most successful approach to computing $M^{-1}$. However, CG requires the matrix being inverted to be hermitian and positive definate, which is not necessarily the case for $M$. We instead invert $M^{\dagger}M$, which {\it{is}} hermitian and positive definate, then we can revocer $M^{-1}$ by acting $M^{\dagger}$ on $(M^{\dagger}M)^{-1}$.

The design of CG requires a bunch of explanation which we will not go into here. We will instead briefly describe the philosophy behind it, and state the algorithm. The goal is, given some vector $b$ and matrix $A$, to find $x$ where
\begin{align}
  Ax = b.
\end{align}
In our case $A=M^{\dagger}M$ and $b$ is a suitably chosen 'source' for the propagator (see sec. \ref{sec:staggeredcorrelators}). This is equivilent to finding the $x=x^*$ that minimizes
\begin{align}
  f(x) = b^TAx - b^Tb.
\end{align}
A reasonable solution to this problem is something like a {\it{steepest descent}} approach, where one starts at a random $x_0$, then moves some distance $\alpha_0$ in the direction $r_0 = x^* - x_0 = b-Ax_0$ to $x_1=x_0-\alpha_0 r_0$, where $\alpha_0$ is chosen to minimize $r_1= x^*-x_1$. And then repeat. This approach has the property that each new step $\alpha_n r_n$ is orthogonal to every other step, this means the algorithm takes a sub-optimal zig-zag path towards the solution.

CG is designed to take a more direct path, by imposing the condition that the direction of each step $d_n=(x_n-x_{n-1})/\alpha_n$ is orthogonal with respect to the metric $A$, i.e. $d^T_n A d_m = 0$ for $n\neq m$. The CG algorithm is
\begin{align}
  \nonumber
  x_{n+1} &= x_n + \alpha_n d_n, \text{ where } \\
  \nonumber
  &\alpha_n = {r^T_n r_n \over d^T_n A d_n^T}, \\
  \nonumber
  &d_n=
  \begin{cases}
    r_0, &  n=0 \\
    r_{n} + \beta_n d_{n-1}, & n>0,
  \end{cases} \\
  \nonumber
  &r_n = b - Ax_n, \\
  &\beta_n = {r^T_n r_n \over r^T_{n-1}r_{n-1}}.
  \label{eq:CG}
\end{align}
One terminates the algorithm when some stopping condition is acheived, namely when $r_n < \epsilon$ where $\epsilon$ is some small number referred to as the error tolerance, or when some maximum number of iterations has been reached.

The complexity of the CG algorithm is $\order{c}$ where $c=\lambda_{\text{max}}/\lambda_{\text{min}}$ is the condition number of the matrix $A$ ($\lambda_{\text{max/min}}$ are the largest and smallest eigenvalues of $A$). The condition number quantifies the size of rounding errors that accumulate in iterative processes like CG. In our case where $A=M^{\dagger}M  \sim(-i\slashed{D}+m)(i\slashed{D}+m)$, the condition number is proportional to $m^{-2}$. Hence, propagators for lighter quarks are quadratically more expensive to compute than heavier ones. This not only effects the computation of correlation functions between light quarks via $M^{-1}$, but any unquenched calculation with rooting since in that case we must also invert \eqref{eq:rational}.

For this reason, lattice calculations are often computed with unphysically heavy $u/d$ quarks. When computing observables that are sensitive to the light quark masses, modern lattice calculations have measured the observable for a number of light quark masses and extrapolated downwards to the physical light mass, using chiral perturbation theory as a guide. In the MILC ensembles we use in this work, summarized in table \ref{tab:ensembles}, all but one have a light mass at around $m_l/m_s \simeq 1/5$, while set 3 has roughly physical light quarks at $m_l/m_s \simeq 1/30$.


\subsection{Staggered Correlation Functions}
\label{sec:staggeredcorrelators}

We now turn to how to evaluate traces of quark propagators like in \eqref{eq:lattice_correlator}, specifically in the staggered formalism. %Recall in the staggered formalism we replace the Dirac spinor $\psi(x)$ with a single-component staggered quark via $\psi(x)=\gamma_x \chi(x)$. Then, we can gather up all of the spin structure in the resulting $\gamma$'s and the spin trace can be evaluated to obtain a so-called {\it{staggered phase}}.

Recall $\psi-$propagators $M^{-1}$ are related to $\chi-$propagators $g$ by
\begin{align}
  M^{-1}(x,y) = \gamma_x\gamma^{\dagger}_y g(x,y).
\end{align}
Throughout this section we will keep the $U$-dependence of $M^{-1}$ and $g$ implicit. By conjugating both sides and using the property of the naive propagator $(M^{-1})^{\dagger}(x,y) = \gamma_5 M^{-1}(y,x)\gamma_5$ (known as $\gamma_5$-hermiticity) one can show that $M^{-1}$ can also be written as
\begin{align}
  \label{eq:Gconj}
  M^{-1}(x,y) = \phi_5(x)\phi_5(y) \gamma_x\gamma_y g^{\dagger}(y,x),
\end{align}
where $\phi_5(x) = (-1)^{\sum_{\mu} x_{\mu}}$.

\subsubsection{2-point correlation functions}

Consider the generic 2-point correlator:
\begin{align}
  \nonumber
  C(x,y) &= \langle \Phi^{\dagger}_X(x) \Phi_Y(y) \rangle_{\psi,U} \quad , \quad \Phi_X(x) = {1\over 4}\bar{\psi}_a(x) \gamma_X \psi_b(x) \\
  \nonumber
  &= {1\over 16}\langle \text{Tr}_{c,s} \gamma_X M^{-1}_{a}(x,y) \gamma_Y M^{-1}_{b}(y,x) \rangle_U \\
  &= {1\over 16}\text{Tr}_s \left( \gamma^{\dagger}_x \gamma_X \gamma_x \gamma_y^{\dagger} \gamma_Y \gamma_y \right)
  \langle \text{Tr}_c \left( M^{-1}_{a}(x,y) M^{-1}_{b}(y,x) \right) \rangle_U
\end{align}
$\text{Tr}_s$ is a trace over spin and $\text{Tr}_c$ is over colour. To deal with the spin trace, define the family of phases $\{\phi_X(x)\}$ according to
\begin{align}
  \gamma^{\dagger}_x\gamma_X\gamma_x = \phi_X(x) \gamma_X.
\end{align}
for example, if $X=5$, then $\gamma^{\dagger}_x\gamma_5\gamma_x = (-1)^{\sum_{\mu}x_{\mu}} \gamma^{\dagger}_x\gamma_x \gamma_5 = \phi_5(x) \gamma_5$. The map from $X$ to $\phi_X$ is structure preserving, i.e. if $\gamma_X=\gamma_A\gamma_B$, then $\phi_X(x)=\phi_A(x)\phi_B(x)$. The spin trace becomes $\phi_X(x)\phi_Y(y) \text{Tr}_s\left( \gamma_X \gamma_Y \right)$. The remaining trace will vanish unless $Y=X$, and is 4 otherwise. We end up with
\begin{align}
  C(x,y) = {1\over 4} \phi_{5X}(x)\phi_{5X}(y) \langle \,\text{Tr}_c \,g_a(x,y) g^{\dagger}_b(x,y) \,\rangle_U,
\end{align}
where we have appled \eqref{eq:Gconj} to $M^{-1}_b$ and $\phi_{5X}(x) = \phi_5(x)\phi_X(x)$. To obtain the correlation function of a meson in a momentum eigenstate with spacial momentum ${\textbf{p}}$, the above must be replaced with
\begin{align}
  \nonumber
  C_{\textbf{p}}(t_0,t) &= {1\over N_x^3} \sum_{{\textbf{x}},{\textbf{y}}} e^{i{\textbf{p}}\cdot({\textbf{x}}-{\textbf{y}})}
  C({\textbf{x}},t_0;{\textbf{y}},t) \\
  &= {1\over 4 N_x^3} \sum_{{\textbf{x}},{\textbf{y}}} e^{i{\textbf{p}}\cdot({\textbf{x}}-{\textbf{y}})} \phi_{5X}(x)\phi_{5X}(y) \langle \,\text{Tr}_c \,g_a(x,y)g^{\dagger}_b(x,y)\,\rangle_U,
\end{align}
where it is understood that $x_0=t_0$ and $y_0=t$. In order to evaluate this function, the simulation must perform inversions to create $g_{a/b}(x,y)$ for each $x$ and $y$, so $2\cdot$Vol$^2$ operations. This is prohibitively expensive. The number of inversions can be reduced using {\it{random wall sources}}. Define
\begin{align}
  P^{t_0}_{a,{\textbf{p}},X}(y) \equiv {1\over \sqrt{N_x^3}} \sum_{\textbf{x}} e^{i{\textbf{p}}\cdot ({\textbf{x}}-{\textbf{y}})} \phi_{5X}({\textbf{x}},t_0) \xi({\textbf{x}}) g_a({\textbf{x}},t_0;y),
\end{align}
where $\xi({\textbf{x}})$ is a random field of colour vectors, varying configuration-by-configuration. This has the property
\begin{align}
  \langle f({\textbf{x}},{\textbf{x}}') \xi^*({\textbf{x}}')\xi({\textbf{x}})\rangle_U = \delta_{{\textbf{x}},{\textbf{x}}'} \langle f({\textbf{x}},{\textbf{x}}') \rangle_U.
\end{align}
Using this property the correlator can be built instead according to
\begin{align}
  \boxed{\quad  \quad C(t_0,t) = {1\over 4} \sum_{\textbf{y}} \phi_{5X}(y) \langle \,\text{Tr}_c \, P^{t_0}_{a,{\textbf{p}},X}({\textbf{y}},t) P^{t_0}_{b,{\textbf{0}},1}({\textbf{y}},t) \,\rangle_U. \quad}
  \label{eq:tietogether}
\end{align}
Now all one has to compute is $P^{t_0}_{a/b}(y)$ for general $y$, so $2\cdot$Vol operations, a reduction by a factor of Vol.

\subsubsection{3-point correlation functions}

The above discussion can be generalized to $3-$(or $N-$)point correlation functions using {\it{extended sources}}. Consider a 3-point correlation function, for example encoding an $X\to Y$ semileptonic decay via a current $J(y)$;
\begin{align}
  C(x,y,z) = \langle \Phi^{\dagger}_X(x) J(y) \Phi_Z(z) \rangle_{\psi,U} \quad , \quad \Phi_X(x) &= {1\over 4} \bar{\psi}_b(x) \gamma_X \psi_s(x) \\
  \nonumber
  J(y) &= \bar{\psi}_b(y)\gamma_J\psi_a(y) \\
  \nonumber
  \Phi_Z(z) &= {1\over 4}\bar{\psi}_a(z)\gamma_Z \psi_s(z).
\end{align}
We can reduce this in the same way as before
\begin{align}
  C(x,y,z) &= {1\over 16} \text{Tr}_s\left( \gamma^{\dagger}_x \gamma_X \gamma_x \gamma^{\dagger}_y \gamma_J \gamma_y \gamma^{\dagger}_z \gamma_Z \gamma_z \right) \langle \text{Tr}_c g_{b}(x,y) g_{a}(y,z) g_{s}(x,z)\rangle_U \\
  &= {1\over 4} \phi_{5X}(x) \phi_J(y) \phi_{5Z}(z) \langle \text{Tr}_c g_{b}(x,y) g_{a}(y,z) g^{\dagger}_{s}(x,z) \rangle_U.
\end{align}
We have assumed that $\text{Tr}_s \gamma_X\gamma_J\gamma_Z = 4$, requiring that each gamma matrix in this combination has a partner and therefore cancels.

Putting $X$ into an eigenstate of zero momentum, and $Y$ into an eigenstate of momentum ${\text{p}}$, we get
\begin{align}
  \nonumber
  C_{\textbf{p}}(t_0,t,T) =& {1\over 4 N_x^3} \sum_{{\textbf{x}},{\textbf{y}},{\textbf{z}}} e^{i{\textbf{p}}\cdot({\textbf{y}}-{\textbf{z}})} \phi_{5X}(x) \phi_J(y) \phi_{5Z}(z) \\ &\times\langle \text{Tr}_c\, g_{b}({\textbf{x}},t_0;{\textbf{y}},t) g_{a}({\textbf{y}},t,{\textbf{z}},T) g^{\dagger}_{s}({\textbf{x}},t_0;{\textbf{z}},T) \rangle_U.
  \label{eq:3ptfullexpr}
\end{align}
This can be built by first creating propagators for the $b$ and $s$ quarks - $P^{t_0}_{b,{\textbf{0}},X}(y)$,$P^{t_0}_{s,{\textbf{0}},1}(z)$. Then, build the $a$ propagator using an extended source, i.e.:
\begin{align}
  P^T_{a,{\textbf{p}},ext}(y) = \sum_{{\textbf{z}}} P^{t_0}_{s,{\textbf{0}},1}({\textbf{z}},T) \phi_{5Z}({\textbf{z}},T) g_{a}({\textbf{z}},T;y).
\end{align}
Then, $P^{t_0}_{b,{\textbf{0}},X}(y)$ and $P^T_{a,{\textbf{p}},ext}(y)$ can be used to construct \eqref{eq:tietogether}, giving a result for the 3-point correlation function.

\subsubsection{Momentum Twist}

The momentum space 2-point correlation function for an operator $\mathcal{O}$ with external momentum ${\textbf{p}}$ is given by
\begin{align}
  C_{\textbf{p}}(0,t) = \sum_{{\textbf{x}}} e^{i{\textbf{p}}\cdot{\textbf{x}}} \langle \mathcal{O}^{\dagger} ({\textbf{x}},t) \mathcal{O}({\textbf{0}},0) \rangle.
\end{align}
To extend the method for computing zero momentum correlators to non-zero, one needs to add an appropriate phase to the operators;
\begin{align}
  \label{eq:phirephase}
  &\mathcal{O}({\textbf{x}},t) \rightarrow \mathcal{O}({\textbf{x}},t)e^{-i{\textbf{p}}\cdot{\textbf{x}}} \\
  \implies &C({\textbf{0}},t) \rightarrow C({\textbf{p}},t).
\end{align}
This generalised straightforwardly to $n$-point functions. One can assign the rephasing to any factor in $\mathcal{O}$, for example a fermion operator
\begin{align}
  \psi({\textbf{x}},t) \rightarrow \psi({\textbf{x}},t)e^{-i{\textbf{p}}\cdot{\textbf{x}}}.
\end{align}
Rephasing $\psi$ is equivalent to introducing the so-called {\it{momentum twist}} to the gauge links \cite{Guadagnoli:2005be}. The action of \eqref{eq:phirephase} on any gauge invariant quantity is equivalent to
\begin{align}
  U_i \rightarrow U_i e^{ip_i}\quad\text{(no sum)}.
  \label{eq:twist}
\end{align}
For example consider the effect this has on the following operator
\begin{align}
  \nonumber
  &\psi^{\dagger}(x) U_{\mu}(x) U_{\nu}(x+a\hat{\mu}) \psi(x+a\hat{\mu}+a\hat{\nu}) \\
  \nonumber
  \rightarrow &\psi^{\dagger}(x) \big( e^{ip_{\mu}}U_{\mu}(x) \big) \big( e^{ip_{\nu}}U_{\nu}(x+a\hat{\mu}) \big) \psi(x+a\hat{\mu}+a\hat{\nu})
  \\
  \rightarrow &\psi^{\dagger}(x)e^{-{\textbf{p}\cdot\textbf{x}}}U_{\mu}(x) U_{\nu}(x+a\hat{\mu}) e^{-{\textbf{p}\cdot(\textbf{x}}+a\hat{\mu}+a\hat{\nu})}\psi(x+a\hat{\mu}+a\hat{\nu}).
\end{align}
\eqref{eq:twist} is how external momenta is simulated in the calculations in this thesis.

\section{Analysis of Correlation Functions}

Once correlation functions like $C_{\textbf{p}}(t_0,t)$ and $C_{\textbf{p}}(t_0,t,T)$ have been computed on the lattice (typically one computes these quantities for all possible $t$), how can we extract physics from them?

\subsection{Fitting Correlation Functions}

Typically 2-point correlators are used to find masses and decay sontants of the propagating meson. One performs a $\chi^2-$fit of the correlator to a theoretically motivated function of $t$. To derive such a function, we use a complete set of momentum ${\textbf{p}}$ states -
\begin{align}
  1 = \sum_{n=0} {1\over 2E_n} | \lambda_n \rangle \langle \lambda_n |,
\end{align}
where $E_n$ are the energies of each state. Inserting this into the correlation function, and moving from the Heisenberg to Schr\"odinger picture;
\begin{align}
  C_{{\textbf{p}}}(t) = \sum_{n=0}& {1\over 2E_n} \langle \Omega | \left( e^{Ht} + e^{H(T_{\text{lat}}-t)} \right)  \Phi({\textbf{p}},0) \left( e^{-Ht} + e^{-H(T_{\text{lat}}-t)} \right) | \lambda_n \rangle
  \nonumber
  \\&\times \langle \lambda_n | \Phi^{\dagger}({\textbf{p}},0) | \Omega \rangle
  \nonumber
  \\ = \sum_{n=0}& \left( {\langle \Omega | \Phi({\textbf{p}},0) | \lambda_n \rangle \over \sqrt{2E_n}} \right) \left( {\langle \lambda_n | \Phi^{\dagger}({\textbf{p}},0) | \Omega \rangle \over \sqrt{2E_n} } \right) \left( e^{-\bar{E}_n t} + e^{-\bar{E}_n (T_{\text{lat}}-t)} \right)
  \nonumber
  \\[10pt] \equiv \sum_{n=0}& |a_n|^2 f(\bar{E}_n,t) \quad,\quad f(E,t) = \left( e^{-E t} + e^{-E(T_{\text{lat}}-t)} \right),
  \label{eq:multiexponential}
\end{align}
where $T_{\text{lat}}=aN_t$ is the temporal extent of the lattice. We have here set $t_0=0$ for clarity. The fit results in a determination of the parameters $a_n$, and $\bar{E}_n$. In all of our calculations we use $n\in[0,5]$. The sum over $n$ will be populated only by states $|\lambda_n\rangle$ with the same quantum numbers as $\Phi$, since $\langle\Omega | \Phi | \lambda_n \rangle$ would vanish otherwise. We can then interpret $|\lambda_0\rangle$ to be the ground state of the meson we are studying. The exponential decays mean the fit function is dominated by the ground state at large $t$, and subsequent excited states become less important as $n$ increases. Hence by only including $C_{{\textbf{p}}}(t)$ at suitably large $t$ values, we can affort to truncate the sum in $n$. In our fits we use $n\in[0,5]$.

We maintain a distinction between $\bar{E}_n$ and $E_n$, since for example in calculations involving NRQCD quarks these differ - $\bar{E}_n$ is not the relativistic energy but rather goes like ${\textbf{p}}^2/2m$.

If this is not an issue, as is the case with HISQ, one can compute the correlation function at zero momentum $C_{{\textbf{0}}}(t)$, then fit it to find the parameter $\bar{E}_0$, which will equal the meson's mass $M$. $a_n$ can be related to the meson's decay constant. For example for a pseudoscalar meson; via the definition of a meson decay constant \eqref{eq:decay_constant_def} and the Ward identity in \eqref{eq:axial_ward_indiv}, we find
\begin{align}
  f_M = (m_a-m_b) \sqrt{2\over M^3} \left({a_0\over a^{3/2}}\right).
\end{align}

The above discussion can be straightforwardly generalized to 3-point correlation functions, from which we are able to extract quantities like the hadronic transition amplitudes $\langle M' | J_{\mu} | M \rangle$, from which we can determine semileptonic form factors.

The generalization of the above for 3-point correlators is
\begin{align}
  \nonumber
  C_3(t,T) =& \sum_{n,m}  \left( {\langle 0 | \Phi_{M'} | \lambda_n \rangle \over \sqrt{2E_{M,n}}} \right) \left({\langle \lambda_n | V_{\mu} | \lambda_m \rangle \over 2\sqrt{ E_{M,n} E_{M',m} } }\right) \left( {\langle \lambda_m | \Phi_{M}^{\dagger} | 0 \rangle \over \sqrt{2E_{M,n}} } \right) \\ \nonumber &\times f(\bar{E}_{M',m},T-t) f(\bar{E}_{M,n},t) \\
  \equiv& \sum_{n,m} a_{M',n} J_{nm} a^*_{M,m} \,\, f(\bar{E}_{M',m},T-t) f(\bar{E}_{M,n},t).
  \label{eq:3ptfitfunction}
\end{align}
$a_{M,n}$ will vanish for states $|\lambda_n\rangle$ which have different quantum numbers to $\Phi_{M}$, and similarly for $a_{M',m}$ and $\Phi_{M'}$. Non-zero $a_{M,n}$'s will match the analagous parameters extracted from fitting a 2-point function $\langle \Phi_{M}^{\dagger} \Phi_{M} \rangle$, similarly for $a_{M',m}$'s and $\Phi_{M'}$. This carries on to the energies, $\{\bar{E}_{M,n}\}$ is the spectrum for the $M'$ meson, and $\{\bar{E}_{M'm}\}$ is the spectrum for the $M$. Therefore, we compute and fit the appropriate 2-point functions to deduce the parameters $\{a_{M^{(')},n}\}$,$\{\bar{E}_{M^{(')},n}\}$. Then, fitting $C_{\textbf{p}}(t,T)$ results in an accurate determination of the remaining free parameters, $J_{nm}$. This set contains the transition amplitude one is interested in $\langle M' | J_{\mu} | M \rangle$, recoginising that
\begin{align}
  J_{00} = {\langle M' | J_{\mu} | M \rangle \over 2\sqrt{E^{M} E^{M'} } }.
\end{align}

\subsubsection{Oscillating States}

In the case of staggered quarks, these fit functions must be modified to contain the effects of the so-called {\it{oscillating states}}.
The oscillating states are the  $\zeta=(1,0,0,0)$ taste. No other tastes contribute, since $\Phi_{{\textbf{p}}}$ has a 3-momentum fixed at ${\textbf{p}}$, which we always take to be small relative to $\pi/a$, hence does not couple to the states at $k\sim(0,\pi/a,0,0)$, $k\sim(0,0,\pi/a,0)$ etc. However, $\Phi_{{\textbf{p}}}$ can couple to arbitrarily high energy states, so the $k\sim(\pi/a,0,0,0)$ doubler contributes. The contribution of this extra taste to $\Phi_M = \bar{\psi}'\gamma_M\psi$ can be found by shifting it down to energies around ${\textbf{p}}$ via the doubling transform $\psi\to (i\gamma_5\gamma_0)(-1)^{t/a} \psi$. So for example if $M$ is a pseudoscalar the extra taste is $\Phi_M \to i(-1)^{t/a} \bar{\psi}\gamma_0 \psi$, a scalar meson with a phase $(-1)^t/a$.

There is a special case where oscillating states do not contribute. If the two quarks in $\Phi_M$ are degenerate (have the same flavour, momentum etc.) then the doubling symmetry acts on both $\psi$ and $\psi'$. If $M$ is a pseudoscalar, $\gamma_M=\gamma_5$, then the effect of the doubling symmetry cancels, and no oscillating states contribute.
\begin{align}
  \bar{\psi}\gamma_5 \psi \to -(-1)^{2\times t/a} \bar{\psi} (i\gamma_5\gamma_0) \gamma_5 (i\gamma_5\gamma_0) \psi = \bar{\psi}\gamma_5\psi.
\end{align}

Accounting for oscillating states modifies the fit functions to
\begin{align}
  C_{\textbf{p}}(t)|_{\text{fit}} =& \sum_{j=0}^{N_{\text{exp}}} |a_j|^2 f(\bar{E}_j,t) + (-1)^{t/a} |a_{j,o}|^2 f(\bar{E}_{j,o},t) \\
  C_{3}(t,T)|_{\text{fit}} =& \sum_{j,k=0}^{N_{\text{exp}},N_{\text{exp}}} \Big(\, a^{M}_j J^{nn}_{jk} a^{M'}_k f(E^{H_s},t) f(E^{M'}_n,T-t)
  \\ \nonumber
  &+a^{M,o}_j J^{on}_{jk} a^{M'}_k (-1)^t f(E^{M,o}_n,t) f(E^{M'},T-t)
  \\ \nonumber
  &+a^{M}_j J^{no}_{jk} a^{M',o}_k (-1)^{T-t} f(E^{M},t) f(E^{M'^*,o}_n,T-t)
  \\
  &+a^{M,o}_j J^{oo}_{jk} a^{M',o}_k (-1)^T f(E^{M,o}_n,t) f(E^{M',o},T-t) \,\Big).
  \label{eq:2ptcorrelator_real}
\end{align}

We use the \texttt{CorrFitter} package \cite{CorrFitter} for performing Bayesian least-squares fitting to the correlation functions. The package employs the trust region method of least-squares fitting. The Bayesian approach, including the formalism used to set priors for the fits, was introduced in \cite{Lepage:2001ym}.

\subsection{Signal Degredation}

A large obstacle in the analysis of correlation functions is the \textit{signal degredation} of correlation functions computed on the lattice.

A random variable $x$ has a mean and standard deviation
\begin{align}
  \hat{x} = \langle x \rangle,\quad
  \sigma^2 = {1\over N} ( \langle x^2 \rangle - \langle x \rangle^2 ),
\end{align}
where $N$ is the size of the sample. So the (square of) the signal/noise ratio is
\begin{align}
  {\hat{x}^2\over \sigma^2} = N \left( {\langle x^2 \rangle \over \langle x \rangle^2} - 1 \right) ^{-1}.
  \label{eq:signal-noise}
\end{align}
Consider 2 point correlators where $x = \Phi^{\dagger}(t) \Phi(0)$, where $\Phi$ is some meson operator.

$\langle x^2 \rangle$ and $\langle x \rangle$ can be written as
\begin{align}
  \label{eq:meandecay}
  \langle x \rangle &= \sum_n {1\over 2E_n} \langle 0 | \Phi^{\dagger}(t) | \lambda_n \rangle \langle \lambda_n | \Phi(0) | 0 \rangle e^{-E_n t} \stackrel{t\to\infty}{\propto} e^{-E_0 t}, \\
  \langle x^2 \rangle &= \sum_n {1\over 2E_n} \langle 0 | \Phi^{\dagger 2}(t) | \lambda_n \rangle \langle \lambda_n | \Phi^2(0) | 0 \rangle e^{-E_n t} \stackrel{t\to\infty}{\propto} e^{-E'_0 t}.
  \label{eq:devdecay}
\end{align}
where we have assumed the ratio of matrix elements and energies are $\mathcal{O}(1)$. The two ground state energies $E_0$ and $E'_0$ need not be the same, since the lowest states for which $\langle \lambda_n | \Phi(0) | 0 \rangle \neq 0$ and $\langle \lambda_n | \Phi^2(0) | 0 \rangle \neq 0$ may differ.

The operator $\Phi^2$ will contain two quark and two antiquark operators, connected by some matrices in spin space. $\Phi^2$ can create a combination of all possible 2 meson states where the mesons are made of the available quark species, and quantum numbers. For example, for 2-point $D$-meson correlators ($c\bar{d}$ pseudoscalars), $E'_0 = (M_{\pi}+M_{\eta_c})$. Plugging $E_0=M_{D_s}$ and this $E'_0$ expression into \eqref{eq:meandecay},\eqref{eq:devdecay} and \eqref{eq:signal-noise}, we see that $D$ meson correlators have a signal/noise ratio that degrades like
\begin{align}
  {\hat{x}^2\over \sigma^2} \propto e^{-(M_{D}-(M_{\pi}+M_{\eta_c})/2)t}.
\end{align}

In general, a meson with two valence quarks of very different masses will suffer from this problem. $B$-mesons suffer more than $D$-mesons. Adding spacial momentum to one of the quarks in the meson would have the effect of replacing $M_D$ in the above equation with some higher energy $E_D$, thus exacerbating the problem further.

\section{Renormalization of Currents}

Once one has computed an observable on the lattice, like $f_M$ or $\langle M' | J_{\mu} | M\rangle$, it needs to be translated into a continuum regularization scheme. Suppose we have some bare operator $\mathcal{O}_0$, we expect this to be related to the renormalized operator in $\overline{MS}$ at scale $\mu$, $\mathcal{O}^{\overline{MS}}(\mu)$, via
\begin{align}
  \mathcal{O}^{\overline{MS}}(\mu) = Z^{\overline{MS}}(\mu) \mathcal{O}_0.
\end{align}
Similarly, in a lattice regularization,
\begin{align}
  \mathcal{O}^{\text{lat}}(1/a) = Z^{\text{lat}}(1/a) \mathcal{O}_0.
\end{align}
Hence we expect a multiplicative factor between the lattice matrix elements, and the continuum $\overline{MS}$ ones:
\begin{align}
  \langle \mathcal{O} \rangle^{\overline{MS}} = \mathcal{Z}(\mu,1/a) \langle \mathcal{O} \rangle^{\text{lat}}
\end{align}
where $\mathcal{Z}(\mu,1/a) = Z^{\overline{MS}}(\mu)/Z^{\text{lat}}(1/a)$. These ``matching factors'' $\mathcal{Z}$ can be deduced by equating observables calculated in both lattice QCD and continuum (appropriately regularized) QCD, producing equations which can be solved for $\mathcal{Z}$. The lattice side of the calculation can be done either through lattice perturbation theory ({\it{perturbative matching}}), or through a lattice calculation ({\it{non-perturbative matching}}).

The result that conserved (or partially conserved) currents (and densities connected to those currents via Ward identities) do not receive any renormalization in any scheme, i.e. $Z^{\text{any}}=1$. They are said to be {\it{absolutely normalized}}.

In principle this is of great help, since the currents that mediate semileptonic decays, e.g. the weak vector and axial currents, are partially conserved, so we are not required to include any matching factors. However, in practice, this is complicated by the fact that the conserved current in the lattice theory is often computationally difficult or impossible to compute. For example, in NRQCD, the partially conserved current corresponding to $SU(N)_V$ is an infinite sum in $1/m_b$ where $m_b$ is the bottom mass. The corresponding current in HISQ is also the sum of a large number of operators. This can be interpreted as a mixing in the renormalization:
\begin{align}
  \langle \mathcal{O}_i \rangle^{\overline{MS}} = \mathcal{Z}_{i,j} \langle \mathcal{O}_j \rangle^{\text{lat}}
\end{align}
Lattice calculations often use only the dominant operators that contribute to the conserved current. Since these will be ``close'' to the conserved current, one can expect the matching factor to only be a small deviation from unity, and the more sub-dominant operators you add, the overall matching factor should tend towards unity.
